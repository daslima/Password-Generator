<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="img/icone.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <title>Password Generator</title>
</head>
<body>
    <main class="container">
        <img class="image__logo" src="img/criptografado.png" alt="Logo" >
        <h2 class="title">Password Generator</h2>
        <section class="result">
            <div class="result__title field-title">
                Generated Password
            </div>
            <div class="result__info right">
                click to copy
            </div>
            <div class="result__info left">
                copied
            </div>
            <div class="result__veiwbox" id="result">
                
            </div>
            <button id="copy-btn" > 
                <i class="fa-regular fa-copy"></i>
            </button>
        </section>
        
        <section class="length range__slider" data-min="4" data-max="32">
            <div class="length__title field-title" data-length="0">
                length: <span class="lengthText"></span>
            </div>
            <input type="range" id="slider" min="4" max="32" value="4">
        
        </section>
        
        <section class="settings">
            <span class="setting__title field-title">
                settings
            </span>
            <div class="setting">
                <input type="checkbox" id="uppercase">
                <label for="uppercase">
                    Include Uppercase
                </label>
            </div>
            <div class="setting">
                <input type="checkbox" id="lowercase" >
                <label for="lowercase">
                    Include Lowercase
                </label>
            </div>
            <div class="setting">
                <input type="checkbox" id="number" checked>
                <label for="number">
                    Include Numbers
                </label>
            </div>
            <div class="setting">
                <input type="checkbox" id="symbol">
                <label for="symbol">
                    Include Symbols
                </label>
            </div>
            <button class="btn generate" id="generate">
                Generate Password
            </button>
        </section>
    </main>

    <script>
        function secureMathRandom() {
            return window.crypto.getRandomValues(new Uint32Array(1))[0] / (Math.pow(2, 32) - 1);
        }

        function getRandomLower() {
            return String.fromCharCode(Math.floor(Math.random() * 26) + 97);
        }

        function getRandomUpper() {
            return String.fromCharCode(Math.floor(Math.random() * 26) + 65);
        }
        function getRandomNumber() {
            return String.fromCharCode(Math.floor(secureMathRandom() * 10) + 48);
        }
        function getRandomSymbol() {
            return String.fromCharCode(Math.floor(Math.random() * 10) + 48);
        }

        const generateBtn = document.getElementById('generate');
        const copyBtn = document.getElementById("copy-btn");
        const copyInfo = document.querySelector('.result__info.right');
        const copiedInfo = document.querySelector(".result__info.left");
        const resultContainer = document.querySelector('.result');
        const resultEl = document.getElementById('result');

let generatedPassword = false;
let resultContainerBound = {left: resultContainer.getBoundingClientRect().left,top: resultContainer.getBoundingClientRect().top};

resultContainer.addEventListener('mousemove', e => {
	resultContainerBound = {left: resultContainer.getBoundingClientRect().left,top: resultContainer.getBoundingClientRect().top};
	
	if(generatedPassword){
		copyBtn.style.opacity = '1';
		copyBtn.style.pointerEvents = 'all';
		copyBtn.style.setProperty('--x', `${e.x - resultContainerBound.left}px`);
		copyBtn.style.setProperty('--y', `${e.y - resultContainerBound.top}px`);
	}
	else {
		copyBtn.style.opacity = '0';
		copyBtn.style.pointerEvents = 'none';
	}
});

window.addEventListener('resize', e => {
	resultContainerBound = {
		left: resultContainer.getBoundingClientRect().left,
		top: resultContainer.getBoundingClientRect().top,
	};
});

copyBtn.addEventListener('click', () => {
	const textarea = document.createElement('textarea');
	const password = resultEl.innerText;

	if (!password) 
		return;

	textarea.value = password;
	document.body.appendChild(textarea);
	textarea.select();
	document.execCommand('copy');
	textarea.remove();
	
	copyInfo.style.transform = "translateY(200%)";
	copyInfo.style.opacity = "0";
	copiedInfo.style.transform = "translatey(0%)";
	copiedInfo.style.opacity = "0.75";
});


//--------------------------------------------------------- COPY TEXT INPUT

resultContainer.addEventListener('mousemove', e => {
	resultContainerBound = {left: resultContainer.getBoundingClientRect().left,top: resultContainer.getBoundingClientRect().top};
	
	if(generatedPassword){
		copyBtn.style.opacity = '1';
		copyBtn.style.pointerEvents = 'all';
		copyBtn.style.setProperty('--x', `${e.x - resultContainerBound.left}px`);
		copyBtn.style.setProperty('--y', `${e.y - resultContainerBound.top}px`);
	}
	else {
		copyBtn.style.opacity = '0';
		copyBtn.style.pointerEvents = 'none';
	}
});

window.addEventListener('resize', e => {
	resultContainerBound = {
		left: resultContainer.getBoundingClientRect().left,
		top: resultContainer.getBoundingClientRect().top,
	};
});

copyBtn.addEventListener('click', () => {
	const textarea = document.createElement('textarea');
	const password = resultEl.innerText;

	if (!password) 
		return;

	textarea.value = password;
	document.body.appendChild(textarea);
	textarea.select();
	document.execCommand('copy');
	textarea.remove();
	
	copyInfo.style.transform = "translateY(200%)";
	copyInfo.style.opacity = "0";
	copiedInfo.style.transform = "translatey(0%)";
	copiedInfo.style.opacity = "0.75";
});

//-------------------------------------------------------------- INPUT RANGE

const slider = document.querySelector(".range__slider");
const sliderValue = document.querySelector(".length__title");
const sliderProps = {fill: "#1d918c", background: "rgba(255, 255, 255, 0.214)"};
const lengthEl = document.getElementById('slider');

function setLengthValue(value){
    document.querySelector(".lengthText").innerText = value == 0 ? 4 : value;
}

function applyFill(slider) {
	const percentage = (100 * (slider.value - slider.min)) / (slider.max - slider.min);
	const bg = `linear-gradient(90deg, ${sliderProps.fill} ${percentage}%, ${sliderProps.background} ${percentage + 0.1}%)`;
	slider.style.background = bg;
	sliderValue.setAttribute("data-length", slider.value);
    let value = sliderValue.getAttribute("data-length");
    setLengthValue(value)
}

slider.querySelector('input').addEventListener("input", event => {
	sliderValue.setAttribute("data-length", event.target.value);
	applyFill(event.target);
});

applyFill(slider.querySelector("input"));

//-------------------------------------------- Generate Password
const uppercaseEl = document.getElementById('uppercase');
const lowercaseEl = document.getElementById('lowercase');
const numberEl = document.getElementById('number');
const symbolEl = document.getElementById("symbol");

const randomFunc = {lower: getRandomLower, upper: getRandomUpper, 
					number: getRandomNumber, symbol: getRandomSymbol};

function generatePassword(length, lower, upper, number, symbol) {

	let generatedPassword = '';
	const typesCount = lower + upper + number + symbol;
	const typesArr = [{lower}, {upper}, {number}, {symbol}].filter(item => Object.values(item)[0]);
	
	if (typesCount === 0) 
		return '';
	

	for (let i = 0; i < length; i++) {
		typesArr.forEach(type => {
			const funcName = Object.keys(type)[0];
			generatedPassword += randomFunc[funcName]();
		});
	}
	return generatedPassword.slice(0, length);
}

function disableOnlyCheckbox() {
	let totalChecked = [uppercaseEl, lowercaseEl, numberEl, symbolEl].filter(el => el.checked)
	totalChecked.forEach(el => {
		if(totalChecked.length == 1){
			el.disabled = true;
		}else {
			el.disabled = false;
		}
	})
}

[uppercaseEl, lowercaseEl, numberEl, symbolEl].forEach(el => {
	el.addEventListener('click', () => {
		disableOnlyCheckbox()
	})
})

generateBtn.addEventListener("click", () => {
	generatedPassword = true;
	copyInfo.style.transform = 'translateY(0%)';
	copyInfo.style.opacity = "0.75";
	copiedInfo.style.transform = "translatey(200%)";
	copiedInfo.style.opacity = "0";

	const length = +lengthEl.value;
	const hasLower = lowercaseEl.checked;
	const hasUpper = uppercaseEl.checked;
	const hasNumber = numberEl.checked;
	const hasSymbol = symbolEl.checked;
	generatedPassword = true;
	resultEl.innerText = generatePassword(length, hasLower, hasUpper, hasNumber, hasSymbol);
});
    </script>
</body>
</html>